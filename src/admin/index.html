<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Content Manager</title>
  </head>
  <body>
    <script>
      // Use a relative config path so it works locally and on GitHub Pages
      window.CMS_CONFIG_PATH = "config.yml?v=4";
    </script>
    <script src="https://unpkg.com/decap-cms@^3/dist/decap-cms.js"></script>
    <script>
      // Editor component: Insert aligned/sized images using markdown-it-attrs classes
      if (window.CMS) {
        CMS.registerEditorComponent({
          id: "aligned-image",
          label: "Image (aligned)",
          fields: [
            { name: "src", label: "Image", widget: "image" },
            {
              name: "alt",
              label: "Alt text",
              widget: "string",
              required: false,
            },
            {
              name: "align",
              label: "Align",
              widget: "select",
              options: [
                { label: "Left", value: "left" },
                { label: "Center", value: "center" },
                { label: "Right", value: "right" },
              ],
              default: "center",
            },
            {
              name: "size",
              label: "Size",
              widget: "select",
              options: [
                { label: "Small (33%)", value: "small" },
                { label: "Medium (66%)", value: "medium" },
                { label: "Full (100%)", value: "full" },
              ],
              default: "medium",
            },
            {
              name: "height",
              label: "Height",
              widget: "select",
              options: [
                { label: "Auto", value: "auto" },
                { label: "200px", value: "200" },
                { label: "300px", value: "300" },
                { label: "400px", value: "400" },
                { label: "500px", value: "500" },
              ],
              default: "auto",
            },
            {
              name: "fade",
              label: "Gradient fade",
              widget: "select",
              options: [
                { label: "None", value: "none" },
                { label: "Top/Bottom", value: "top-bottom" },
                { label: "Left/Right", value: "left-right" },
                { label: "All Sides", value: "all" },
              ],
              default: "none",
            },
          ],
          pattern:
            /^!\[(.*?)\]\((.*?)\)\{\.(img-(left|center|right))\s+\.(img-(small|medium|full))(?:\s+\.img-h-(\d+))?(?:\s+\.(img-fade-(?:top-bottom|left-right|all)))?\}/,
          fromBlock: function (match) {
            return {
              alt: match[1],
              src: match[2],
              align: match[4],
              size: match[6],
              height: match[7] || "auto",
              fade: (match[8] || "").replace("img-fade-", "") || "none",
            };
          },
          toBlock: function ({
            src,
            alt,
            align = "center",
            size = "medium",
            height = "auto",
            fade = "none",
          }) {
            if (!src) return "";
            const hClass = height !== "auto" ? ` .img-h-${height}` : "";
            const fClass = fade !== "none" ? ` .img-fade-${fade}` : "";
            return `![${
              alt || ""
            }](${src}){.img-${align} .img-${size}${hClass}${fClass}}`;
          },
          toPreview: function ({
            src,
            alt,
            align = "center",
            size = "medium",
            height = "auto",
            fade = "none",
          }) {
            if (!src) return "";
            const hClass = height !== "auto" ? ` img-h-${height}` : "";
            const fClass = fade !== "none" ? ` img-fade-${fade}` : "";
            return `<img src="${src}" alt="${
              alt || ""
            }" class="img-${align} img-${size}${hClass}${fClass}" />`;
          },
        });
      }
    </script>
  </body>
</html>
