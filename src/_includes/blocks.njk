{% set __baseDir = '/assets/uploads/' %}
{% for block in blocks %}
  {% if block.type == 'hero' %}
    {% set __himg = block.hero_image %}
    {% if __himg and __himg[0] != '/' %}{% set __himg = __baseDir ~ __himg %}{% endif %}
    {% if __himg %}{% set __himg = __himg | replace('/AiA/assets/', '/assets/') %}{% endif %}
    <section class="hero" {% if __himg %}style="background-image: url('{{ __himg | url }}');"{% endif %}>
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <h1>{{ block.hero_heading or title }}</h1>
        {% if block.hero_text %}<p>{{ block.hero_text }}</p>{% endif %}
      </div>
    </section>
  {% elif block.type == 'richtext' %}
    <div class="prose">
      {{ block.content | markdown | fixImgUrls | safe }}
    </div>
  {% elif block.type == 'image_block' and block.image %}
    {% set __bimg = block.image %}
    {% if __bimg and __bimg[0] != '/' %}{% set __bimg = __baseDir ~ __bimg %}{% endif %}
    {% if __bimg %}{% set __bimg = __bimg | replace('/AiA/assets/', '/assets/') %}{% endif %}
    {% set __fadeClass = '' %}
    {% if block.gradient == 'top-bottom' or block.gradient == 'both' %}{% set __fadeClass = 'img-fade-both' %}
    {% elif block.gradient == 'left-right' or block.gradient == 'sides' %}{% set __fadeClass = 'img-fade-sides' %}
    {% elif block.gradient == 'all' %}{% set __fadeClass = 'img-fade-all' %}
    {% elif block.gradient == 'all-extreme' %}{% set __fadeClass = 'img-fade-all-extreme' %}
    {% endif %}
    <figure class="page-hero {{ __fadeClass }}">
      <img src="{{ __bimg | url }}" alt="" {% if block.height %}style="width: 100%; height: {{ block.height }}px; object-fit: cover; object-position: center;"{% endif %} />
      {% if block.caption %}<figcaption class="intro">{{ block.caption }}</figcaption>{% endif %}
    </figure>
  {% elif block.type == 'video' %}
    {% set __poster = block.poster %}
    {% if __poster and __poster[0] != '/' %}{% set __poster = __baseDir ~ __poster %}{% endif %}
    {% if __poster %}{% set __poster = __poster | replace('/AiA/assets/', '/assets/') %}{% endif %}
    {% if block.file %}
      {% set __v = block.file %}
      {% if __v and __v[0] != '/' and not ('://' in __v) %}{% set __v = __baseDir ~ __v %}{% endif %}
      {% if __v %}{% set __v = __v | replace('/AiA/assets/', '/assets/') %}{% endif %}
      <video controls {% if __poster %}poster="{{ __poster | url }}"{% endif %} style="width:100%;border-radius:12px;border:1px solid var(--border);background:var(--card);">
        <source src="{{ __v | url }}" type="video/mp4" />
      </video>
    {% elif block.url %}
      {% if 'youtube.com' in block.url or 'youtu.be' in block.url or 'vimeo.com' in block.url %}
        {% set __embed = block.url %}
        {# Normalize common YouTube forms to /embed/VIDEO_ID #}
        {% if 'youtu.be/' in __embed %}
          {% set __id = (__embed | replace('https://youtu.be/','') | replace('http://youtu.be/','')) %}
          {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
        {% elif 'youtube.com/watch' in __embed %}
          {% set __id = (__embed | replace('https://www.youtube.com/watch?v=','') | replace('https://youtube.com/watch?v=','') | replace('http://www.youtube.com/watch?v=','') | replace('http://youtube.com/watch?v=','')) %}
          {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
        {% elif 'youtube.com/shorts/' in __embed %}
          {% set __id = (__embed | replace('https://www.youtube.com/shorts/','') | replace('https://youtube.com/shorts/','') | replace('http://www.youtube.com/shorts/','') | replace('http://youtube.com/shorts/','')) %}
          {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
        {% endif %}
        {# Normalize Vimeo to player.vimeo.com/video/ID #}
        {% if 'vimeo.com/' in __embed and not ('player.vimeo.com' in __embed) %}
          {% set __id = (__embed | replace('https://vimeo.com/','') | replace('http://vimeo.com/','')) %}
          {% set __embed = 'https://player.vimeo.com/video/' ~ __id %}
        {% endif %}
        <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;border:1px solid var(--border);background:var(--card);">
          <iframe src="{{ __embed }}" style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>
        </div>
      {% else %}
        <video controls {% if __poster %}poster="{{ __poster | url }}"{% endif %} style="width:100%;border-radius:12px;border:1px solid var(--border);background:var(--card);">
          <source src="{{ block.url }}" />
        </video>
      {% endif %}
    {% endif %}
    {% if block.caption %}<div class="intro">{{ block.caption }}</div>{% endif %}
  {% elif block.type == 'gallery' and block.images and (block.images | length) %}
    <div class="gallery">
      {% for g in block.images %}
        {% set __gimg = g.image %}
        {% if __gimg and __gimg[0] != '/' %}{% set __gimg = __baseDir ~ __gimg %}{% endif %}
        {% if __gimg %}{% set __gimg = __gimg | replace('/AiA/assets/', '/assets/') %}{% endif %}
        <figure>
          <img src="{{ __gimg | url }}" alt="" />
          {% if g.caption %}<figcaption>{{ g.caption }}</figcaption>{% endif %}
        </figure>
      {% endfor %}
    </div>
  {% elif block.type == 'two_column' %}
    <div class="grid-2">
      <div class="prose">{{ block.left | markdown | fixImgUrls | safe }}</div>
      <div class="prose">{{ block.right | markdown | fixImgUrls | safe }}</div>
    </div>
  {% elif block.type == 'cta' and block.url %}
    <p><a class="chip" href="{{ block.url | url }}">{{ block.label or block.text or 'Learn more' }}</a></p>
  {% endif %}
{% endfor %}

