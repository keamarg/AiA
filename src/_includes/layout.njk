<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title or site.title or "AiA" }}</title>
  <style>
    {% set theme = site.theme or {} %}
    :root {
      --bg: {{ theme.bg or '#0b0b0c' }};
      --text: {{ theme.text or '#e7e7ea' }};
      --muted: {{ theme.muted or '#a4a4ad' }};
      --accent: {{ theme.accent or '#7c5cff' }};
      --card: {{ theme.card or '#151518' }};
      --card-2: {{ theme.card_2 or '#1c1c21' }};
      --border: {{ theme.border or '#2a2a31' }};
      --font-family: {{ theme.font_family or "system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" }};
      --font-size: {{ (theme.font_size or 16) }}px;
      --content-max: {{ (theme.content_max_width or 900) }}px;
      --nav-max: {{ (theme.nav_max_width or 1100) }}px;
      --radius: {{ (theme.border_radius or 12) }}px;
      --nav-bg: {{ theme.nav_background or 'rgba(11,11,12,0.7)' }};
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body { background: var(--bg); color: var(--text); font-size: var(--font-size); line-height: 1.6; font-family: var(--font-family); }
    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; height: auto; display: block; }

    /* Nav */
    .nav { position: sticky; top: 0; z-index: 50; background: var(--nav-bg); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); }
    .nav-inner { max-width: var(--nav-max); margin: 0 auto; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 1rem; }
    .brand { font-weight: 700; letter-spacing: 0.2px; color: var(--text); padding: 0.25rem 0.5rem; border-radius: 8px; }
    .brand:hover { color: white; }
    .menu { list-style: none; margin: 0; padding: 0; display: flex; gap: 1rem; }
    .menu > li { position: relative; }
    .menu > li > a { padding: 0.4rem 0.5rem; border-radius: var(--radius); color: var(--muted); display: inline-block; }
    .menu > li > a:hover { color: white; background: var(--card); }
    .has-children > a::after { content: "â–¾"; margin-left: 0.35rem; font-size: 0.8em; }
    .submenu { display: none; position: absolute; left: 0; top: 100%; min-width: 220px; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 0.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    .submenu li { list-style: none; }
    .submenu a { display: block; padding: 0.5rem 0.6rem; border-radius: 8px; color: var(--text); }
    .submenu a:hover { background: var(--card-2); color: white; }
    .menu > li:hover .submenu { display: block; }
    .nav-right { margin-left: auto; display: flex; align-items: center; gap: 0.75rem; }
    .chip { padding: 0.35rem 0.6rem; background: var(--card); border: 1px solid var(--border); border-radius: 100px; color: var(--muted); font-size: 0.9rem; }
    .chip:hover { background: var(--card-2); color: white; }

    /* Hero */
    .hero { position: relative; min-height: 60vh; display: grid; place-items: center; background-size: contain; background-position: center; background-repeat: no-repeat; }
    .hero-overlay { position: absolute; inset: 0; background: radial-gradient(1200px 600px at 20% 10%, rgba(124,92,255,0.25), rgba(124,92,255,0) 60%), linear-gradient(to bottom, rgba(11,11,12,0.2), rgba(11,11,12,0.75)); }
    .hero-content { position: relative; z-index: 1; text-align: center; padding: 3rem 1rem; max-width: 900px; }
    .hero h1 { font-size: clamp(2rem, 5vw, 4rem); margin: 0 0 0.75rem; letter-spacing: -0.02em; }
    .hero p { color: var(--muted); font-size: clamp(1rem, 2vw, 1.25rem); margin: 0 auto; max-width: 60ch; }

    /* Main */
    main { max-width: var(--content-max); margin: 2rem auto; padding: 0 1rem 3rem; }
    .page-hero { margin: 1rem 0 2rem; border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); background: var(--card); }
    .intro { color: var(--muted); margin-bottom: 1rem; }
    .grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 1rem; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 0.75rem; }
    .gallery figure { margin: 0; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; background: var(--card); }
    .page-hero img, .gallery figure img { width: 100%; height: auto; object-fit: contain; }
    .gallery figcaption { padding: 0.5rem 0.6rem; color: var(--muted); font-size: 0.9rem; }
    /* Prose content image utilities */
    .prose::after { content: ""; display: block; clear: both; }
    .prose img { max-width: 100%; height: auto; }
    /* Height utilities */
    .prose img.img-h-200 { height: 200px; width: auto; object-fit: contain; }
    .prose img.img-h-300 { height: 300px; width: auto; object-fit: contain; }
    .prose img.img-h-400 { height: 400px; width: auto; object-fit: contain; }
    .prose img.img-h-500 { height: 500px; width: auto; object-fit: contain; }
    .prose img.img-left { float: left; margin: 0 1rem 1rem 0; }
    .prose img.img-right { float: right; margin: 0 0 1rem 1rem; }
    .prose img.img-center { display: block; margin-left: auto; margin-right: auto; }
    .prose img.img-small { width: 33%; }
    .prose img.img-medium { width: 66%; }
    .prose img.img-full { width: 100%; }
    /* Gradient masks for images (works on page-hero and prose) */
    .img-fade-top { -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%); mask-image: linear-gradient(to bottom, transparent, black 20%); }
    .img-fade-bottom { -webkit-mask-image: linear-gradient(to top, transparent, black 20%); mask-image: linear-gradient(to top, transparent, black 20%); }
    .img-fade-both { -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent); mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent); }
  </style>
  <meta name="theme-color" content="{{ (site.theme and site.theme.bg) or '#0b0b0c' }}">
  {% set __accent = (site.theme and site.theme.accent) or '#7c5cff' %}
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='8' fill='{{ __accent | replace('#','%23') }}'/%3E%3C/svg%3E">
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <a class="brand" href="{{ '/' | url }}">{{ site.title or 'AiA' }}</a>
      <ul class="menu">
        {% if navigation and navigation.items %}
          {% for item in navigation.items %}
            <li class="{% if item.children and (item.children | length) %}has-children{% endif %}">
              <a href="{{ item.url | url }}">{{ item.label }}</a>
              {% if item.children and (item.children | length) %}
                <ul class="submenu">
                  {% for child in item.children %}
                    <li><a href="{{ child.url | url }}">{{ child.label }}</a></li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        {% else %}
          <li><a href="{{ '/' | url }}">Home</a></li>
          <li><a href="{{ '/posts/' | url }}">Blog</a></li>
        {% endif %}
      </ul>
      <div class="nav-right">
        <a class="chip" href="{{ '/admin/' | url }}">Admin</a>
      </div>
    </div>
  </header>

  {% set hasBlocks = blocks and (blocks | length) %}
  {% set __baseDir = '/assets/uploads/' %}
  {% if isHome and not hasBlocks %}
    {% set __hero = hero_image %}
    {% if __hero and __hero[0] != '/' %}{% set __hero = __baseDir ~ __hero %}{% endif %}
    {% if __hero %}{% set __hero = __hero | replace('/AiA/assets/', '/assets/') %}{% endif %}
    <section class="hero" {% if __hero %}style="background-image: url('{{ __hero | url }}');"{% endif %}>
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <h1>{{ hero_heading or title }}</h1>
        {% if hero_text %}<p>{{ hero_text }}</p>{% endif %}
      </div>
    </section>
  {% endif %}

  <main>
    {% if hasBlocks %}
      {% for block in blocks %}
        {% if block.type == 'hero' %}
          {% set __himg = block.hero_image %}
          {% if __himg and __himg[0] != '/' %}{% set __himg = __baseDir ~ __himg %}{% endif %}
          {% if __himg %}{% set __himg = __himg | replace('/AiA/assets/', '/assets/') %}{% endif %}
          <section class="hero" {% if __himg %}style="background-image: url('{{ __himg | url }}');"{% endif %}>
            <div class="hero-overlay"></div>
            <div class="hero-content">
              <h1>{{ block.hero_heading or title }}</h1>
              {% if block.hero_text %}<p>{{ block.hero_text }}</p>{% endif %}
            </div>
          </section>
        {% elif block.type == 'richtext' %}
          <div class="prose">
            {{ block.content | markdown | safe }}
          </div>
        {% elif block.type == 'image_block' and block.image %}
          {% set __bimg = block.image %}
          {% if __bimg and __bimg[0] != '/' %}{% set __bimg = __baseDir ~ __bimg %}{% endif %}
          {% if __bimg %}{% set __bimg = __bimg | replace('/AiA/assets/', '/assets/') %}{% endif %}
          <figure class="page-hero">
            {% set __fadeClass = '' %}
            {% if block.gradient == 'top' %}{% set __fadeClass = 'img-fade-top' %}
            {% elif block.gradient == 'bottom' %}{% set __fadeClass = 'img-fade-bottom' %}
            {% elif block.gradient == 'both' %}{% set __fadeClass = 'img-fade-both' %}
            {% endif %}
            <img src="{{ __bimg | url }}" alt="" class="{{ __fadeClass }}" {% if block.height %}style="height: {{ block.height }}px; width: auto; object-fit: contain;"{% endif %} />
            {% if block.caption %}<figcaption class="intro">{{ block.caption }}</figcaption>{% endif %}
          </figure>
        {% elif block.type == 'video' %}
          {% set __poster = block.poster %}
          {% if __poster and __poster[0] != '/' %}{% set __poster = __baseDir ~ __poster %}{% endif %}
          {% if __poster %}{% set __poster = __poster | replace('/AiA/assets/', '/assets/') %}{% endif %}
          {% if block.file %}
            {% set __v = block.file %}
            {% if __v and __v[0] != '/' and not ('://' in __v) %}{% set __v = __baseDir ~ __v %}{% endif %}
            {% if __v %}{% set __v = __v | replace('/AiA/assets/', '/assets/') %}{% endif %}
            <video controls {% if __poster %}poster="{{ __poster | url }}"{% endif %} style="width:100%;border-radius:12px;border:1px solid var(--border);background:var(--card);">
              <source src="{{ __v | url }}" type="video/mp4" />
            </video>
          {% elif block.url %}
            {% if 'youtube.com' in block.url or 'youtu.be' in block.url or 'vimeo.com' in block.url %}
              {% set __embed = block.url %}
              {# Normalize common YouTube forms to /embed/VIDEO_ID #}
              {% if 'youtu.be/' in __embed %}
                {% set __id = (__embed | replace('https://youtu.be/','') | replace('http://youtu.be/','')) %}
                {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
              {% elif 'youtube.com/watch' in __embed %}
                {% set __id = (__embed | replace('https://www.youtube.com/watch?v=','') | replace('https://youtube.com/watch?v=','') | replace('http://www.youtube.com/watch?v=','') | replace('http://youtube.com/watch?v=','')) %}
                {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
              {% elif 'youtube.com/shorts/' in __embed %}
                {% set __id = (__embed | replace('https://www.youtube.com/shorts/','') | replace('https://youtube.com/shorts/','') | replace('http://www.youtube.com/shorts/','') | replace('http://youtube.com/shorts/','')) %}
                {% set __embed = 'https://www.youtube.com/embed/' ~ __id %}
              {% endif %}
              {# Normalize Vimeo to player.vimeo.com/video/ID #}
              {% if 'vimeo.com/' in __embed and not ('player.vimeo.com' in __embed) %}
                {% set __id = (__embed | replace('https://vimeo.com/','') | replace('http://vimeo.com/','')) %}
                {% set __embed = 'https://player.vimeo.com/video/' ~ __id %}
              {% endif %}
              <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;border:1px solid var(--border);background:var(--card);">
                <iframe src="{{ __embed }}" style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>
              </div>
            {% else %}
              <video controls {% if __poster %}poster="{{ __poster | url }}"{% endif %} style="width:100%;border-radius:12px;border:1px solid var(--border);background:var(--card);">
                <source src="{{ block.url }}" />
              </video>
            {% endif %}
          {% endif %}
          {% if block.caption %}<div class="intro">{{ block.caption }}</div>{% endif %}
        {% elif block.type == 'gallery' and block.images and (block.images | length) %}
          <div class="gallery">
            {% for g in block.images %}
              {% set __gimg = g.image %}
              {% if __gimg and __gimg[0] != '/' %}{% set __gimg = __baseDir ~ __gimg %}{% endif %}
              {% if __gimg %}{% set __gimg = __gimg | replace('/AiA/assets/', '/assets/') %}{% endif %}
              <figure>
                <img src="{{ __gimg | url }}" alt="" />
                {% if g.caption %}<figcaption>{{ g.caption }}</figcaption>{% endif %}
              </figure>
            {% endfor %}
          </div>
        {% elif block.type == 'two_column' %}
          <div class="grid-2">
            <div class="prose">{{ block.left | markdown | safe }}</div>
            <div class="prose">{{ block.right | markdown | safe }}</div>
          </div>
        {% elif block.type == 'cta' and block.url %}
          <p><a class="chip" href="{{ block.url }}">{{ block.label or block.text or 'Learn more' }}</a></p>
        {% endif %}
      {% endfor %}
    {% else %}
      {% if not isHome and image %}
        {% set __img = image %}
        {% if __img and __img[0] != '/' %}{% set __img = __baseDir ~ __img %}{% endif %}
        {% if __img %}{% set __img = __img | replace('/AiA/assets/', '/assets/') %}{% endif %}
        <figure class="page-hero"><img src="{{ __img | url }}" alt="" /></figure>
      {% endif %}
      {% if intro %}
        <div class="intro">{{ intro }}</div>
      {% endif %}
      <div class="prose">
        {{ content | safe }}
      </div>
    {% endif %}
  </main>
</body>
</html>